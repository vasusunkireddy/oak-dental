<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Oak Dental Hospital - Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fadeIn {
            animation: fadeIn 1s ease-out forwards;
        }
        .hover-scale {
            transition: transform 0.3s ease;
        }
        .hover-scale:hover {
            transform: scale(1.05);
        }
        .gradient-btn {
            background: linear-gradient(45deg, #4a90e2, #50c9c3);
            transition: all 0.3s ease;
        }
        .gradient-btn:hover {
            background: linear-gradient(45deg, #50c9c3, #4a90e2);
        }
        html {
            scroll-behavior: smooth;
        }
        video, img {
            object-fit: cover;
            max-height: 100px;
        }
    </style>
</head>
<body class="font-sans bg-gray-100 text-gray-800">
    <!-- Header -->
    <header class="bg-white shadow sticky top-0 z-50">
        <div class="container mx-auto px-4 py-4 flex items-center justify-between">
            <div class="flex items-center space-x-4">
                <img src="https://i.postimg.cc/yNwBc6rJ/dental.jpg" alt="Oak Dental Logo" class="h-16 w-auto">
                <div>
                    <h1 class="text-2xl font-bold text-blue-600">Oak Dental Hospital - Admin</h1>
                    <p class="text-sm text-gray-600">A Multi-Speciality & Implant Center</p>
                </div>
            </div>
            <nav class="hidden md:flex space-x-6" id="admin-nav">
                <a href="#login" class="text-gray-600 hover:text-blue-600 transition">Login</a>
                <a href="#register" class="text-gray-600 hover:text-blue-600 transition">Register</a>
                <a href="#appointments" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Appointments</a>
                <a href="#treatments" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Treatments</a>
                <a href="#timings" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Timings</a>
                <a href="#logout" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Logout</a>
            </nav>
            <button id="mobile-menu-btn" class="md:hidden text-gray-600 focus:outline-none">
                <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"/>
                </svg>
            </button>
        </div>
        <div id="mobile-menu" class="hidden md:hidden bg-white shadow">
            <nav class="flex flex-col space-y-4 px-4 py-6" id="mobile-admin-nav">
                <a href="#login" class="text-gray-600 hover:text-blue-600 transition">Login</a>
                <a href="#register" class="text-gray-600 hover:text-blue-600 transition">Register</a>
                <a href="#appointments" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Appointments</a>
                <a href="#treatments" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Treatments</a>
                <a href="#timings" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Manage Timings</a>
                <a href="#logout" class="text-gray-600 hover:text-blue-600 transition hidden admin-nav">Logout</a>
            </nav>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container mx-auto px-4">
        <!-- Admin Login Section -->
        <section id="login" class="py-16 bg-gray-50">
            <div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow animate-fadeIn">
                <h2 class="text-2xl font-bold mb-6 text-center">Admin Login</h2>
                <div class="space-y-4">
                    <input type="text" id="admin-username" placeholder="Username" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="password" id="admin-password" placeholder="Password" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="login-btn" class="gradient-btn text-white w-full py-3 rounded-lg font-semibold hover-scale">Login</button>
                </div>
                <p class="text-center mt-4">New Admin? <a href="#register" class="text-blue-600 hover:underline">Register</a></p>
            </div>
        </section>

        <!-- Admin Registration Section -->
        <section id="register" class="py-16 bg-gray-50 hidden">
            <div class="max-w-md mx-auto bg-white p-8 rounded-lg shadow animate-fadeIn">
                <h2 class="text-2xl font-bold mb-6 text-center">Admin Registration</h2>
                <div class="space-y-4">
                    <input type="text" id="reg-username" placeholder="Username" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="password" id="reg-password" placeholder="Password" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="email" id="reg-email" placeholder="Email" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="register-btn" class="gradient-btn text-white w-full py-3 rounded-lg font-semibold hover-scale">Register</button>
                </div>
                <p class="text-center mt-4">Already registered? <a href="#login" class="text-blue-600 hover:underline">Login</a></p>
            </div>
        </section>

        <!-- Manage Appointments Section -->
        <section id="appointments" class="py-16 hidden">
            <div class="bg-white p-8 rounded-lg shadow animate-fadeIn">
                <h2 class="text-3xl font-bold mb-6 text-center">Manage Appointments</h2>
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="p-3">Name</th>
                            <th class="p-3">Phone</th>
                            <th class="p-3">Treatment</th>
                            <th class="p-3">Fee</th>
                            <th class="p-3">Date</th>
                            <th class="p-3">Time</th>
                            <th class="p-3">Status</th>
                            <th class="p-3">Payment</th>
                            <th class="p-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="appointments-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Manage Treatments Section -->
        <section id="treatments" class="py-16 hidden">
            <div class="bg-white p-8 rounded-lg shadow animate-fadeIn mb-12">
                <h2 class="text-3xl font-bold mb-6 text-center">Manage Treatments</h2>
                <h3 class="text-2xl font-semibold mb-6">Add/Edit Treatment</h3>
                <div class="space-y-4">
                    <input type="hidden" id="treatment-id">
                    <input type="text" id="treatment-name" placeholder="Treatment Name" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="number" id="treatment-price" placeholder="Price (₹)" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="file" id="treatment-image" accept="image/*" class="w-full p-3 border rounded-lg">
                    <input type="file" id="treatment-video" accept="video/*" class="w-full p-3 border rounded-lg">
                    <button id="add-treatment" class="gradient-btn text-white w-full py-3 rounded-lg font-semibold hover-scale">Save Treatment</button>
                </div>
            </div>
            <div class="bg-white p-8 rounded-lg shadow animate-fadeIn">
                <h3 class="text-2xl font-semibold mb-6">Current Treatments</h3>
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="p-3">Name</th>
                            <th class="p-3">Price</th>
                            <th class="p-3">Image</th>
                            <th class="p-3">Video</th>
                            <th class="p-3">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="treatments-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Manage Timings Section -->
        <section id="timings" class="py-16 hidden">
            <div class="bg-white p-8 rounded-lg shadow animate-fadeIn mb-12">
                <h2 class="text-3xl font-bold mb-6 text-center">Manage Hospital Timings</h2>
                <h3 class="text-2xl font-semibold mb-6">Update Timings</h3>
                <div class="space-y-4">
                    <select id="timing-day" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                        <option value="Sunday">Sunday</option>
                    </select>
                    <input type="time" id="open-time" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <input type="time" id="close-time" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    <button id="update-timing" class="gradient-btn text-white w-full py-3 rounded-lg font-semibold hover-scale">Update Timing</button>
                </div>
            </div>
            <div class="bg-white p-8 rounded-lg shadow animate-fadeIn">
                <h3 class="text-2xl font-semibold mb-6">Current Timings</h3>
                <table class="w-full text-left">
                    <thead>
                        <tr class="bg-gray-200">
                            <th class="p-3">Day</th>
                            <th class="p-3">Open</th>
                            <th class="p-3">Close</th>
                        </tr>
                    </thead>
                    <tbody id="timings-table-body"></tbody>
                </table>
            </div>
        </section>

        <!-- Appointment Details Modal -->
        <div id="appointment-details" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow max-w-md w-full">
                <h2 class="text-2xl font-bold mb-4">Appointment Details</h2>
                <p><strong>Name:</strong> <span id="detail-name"></span></p>
                <p><strong>Phone:</strong> <span id="detail-phone"></span></p>
                <p><strong>Treatment:</strong> <span id="detail-treatment"></span></p>
                <p><strong>Fee:</strong> <span id="detail-price"></span></p>
                <p><strong>Date:</strong> <span id="detail-date"></span></p>
                <p><strong>Time:</strong> <span id="detail-time"></span></p>
                <p><strong>Status:</strong> <span id="detail-status"></span></p>
                <p><strong>Approved:</strong> <span id="detail-approved"></span></p>
                <p><strong>Cancel Reason:</strong> <span id="detail-cancel-reason"></span></p>
                <p><strong>Reschedule Reason:</strong> <span id="detail-reschedule-reason"></span></p>
                <p><strong>Admin Reason:</strong> <span id="detail-admin-reason"></span></p>
                <p><strong>Payment ID:</strong> <span id="detail-payment-id"></span></p>
                <div class="flex justify-end space-x-4 mt-6">
                    <button id="approve-appointment" class="gradient-btn text-white px-4 py-2 rounded-lg hover-scale">Approve</button>
                    <button id="cancel-appointment" class="bg-red-500 text-white px-4 py-2 rounded-lg hover-scale">Cancel</button>
                    <button id="close-details" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">Close</button>
                </div>
            </div>
        </div>

        <!-- Cancel Appointment Modal -->
        <div id="cancel-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
            <div class="bg-white p-8 rounded-lg shadow max-w-md w-full">
                <h2 class="text-2xl font-bold mb-4">Cancel Appointment</h2>
                <textarea id="cancel-reason" placeholder="Reason for Cancellation" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 mb-4"></textarea>
                                <div class="flex justify-end space-x-4">
                    <button id="close-cancel" class="bg-gray-300 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-400">Close</button>
                    <button id="confirm-cancel" class="gradient-btn text-white px-4 py-2 rounded-lg hover-scale">Cancel Appointment</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mobile menu toggle
        const mobileMenuBtn = document.getElementById('mobile-menu-btn');
        const mobileMenu = document.getElementById('mobile-menu');
        mobileMenuBtn.addEventListener('click', () => {
            mobileMenu.classList.toggle('hidden');
        });

        // Handle navigation
        document.querySelectorAll('nav a').forEach(link => {
            link.addEventListener('click', (e) => {
                e.preventDefault();
                const targetId = link.getAttribute('href').substring(1);
                document.getElementById(targetId)?.scrollIntoView({ behavior: 'smooth' });
                mobileMenu.classList.add('hidden');
            });
        });

        // Authentication state
        let token = localStorage.getItem('adminToken') || null;
        updateNav();

        function updateNav() {
            const adminLinks = document.querySelectorAll('.admin-nav');
            const loginLink = document.querySelector('a[href="#login"]');
            const registerLink = document.querySelector('a[href="#register"]');
            const loginSection = document.getElementById('login');
            const registerSection = document.getElementById('register');
            const appointmentsSection = document.getElementById('appointments');
            const treatmentsSection = document.getElementById('treatments');
            const timingsSection = document.getElementById('timings');

            if (token) {
                adminLinks.forEach(link => link.classList.remove('hidden'));
                loginLink.classList.add('hidden');
                registerLink.classList.add('hidden');
                loginSection.classList.add('hidden');
                registerSection.classList.add('hidden');
                appointmentsSection.classList.remove('hidden');
                treatmentsSection.classList.remove('hidden');
                timingsSection.classList.remove('hidden');
            } else {
                adminLinks.forEach(link => link.classList.add('hidden'));
                loginLink.classList.remove('hidden');
                registerLink.classList.remove('hidden');
                loginSection.classList.remove('hidden');
                registerSection.classList.add('hidden');
                appointmentsSection.classList.add('hidden');
                treatmentsSection.classList.add('hidden');
                timingsSection.classList.add('hidden');
            }
        }

        // Admin login
        document.getElementById('login-btn').addEventListener('click', async () => {
            const username = document.getElementById('admin-username').value;
            const password = document.getElementById('admin-password').value;
            if (!username || !password) {
                alert('Username and password required');
                return;
            }

            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.message);

                token = result.token;
                localStorage.setItem('adminToken', token);
                updateNav();
                fetchAppointments();
                fetchTreatments();
                fetchTimings();
                document.getElementById('admin-username').value = '';
                document.getElementById('admin-password').value = '';
            } catch (error) {
                alert('Login failed: ' + error.message);
            }
        });

        // Admin registration
        document.getElementById('register-btn').addEventListener('click', async () => {
            const username = document.getElementById('reg-username').value;
            const password = document.getElementById('reg-password').value;
            const email = document.getElementById('reg-email').value;
            if (!username || !password || !email) {
                alert('All fields required');
                return;
            }

            try {
                const response = await fetch('/api/admin/register', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password, email })
                });
                const result = await response.json();
                if (!response.ok) throw new Error(result.message);

                alert('Registration successful. Please login.');
                document.getElementById('reg-username').value = '';
                document.getElementById('reg-password').value = '';
                document.getElementById('reg-email').value = '';
                document.getElementById('login').scrollIntoView({ behavior: 'smooth' });
            } catch (error) {
                alert('Registration failed: ' + error.message);
            }
        });

        // Logout
        document.querySelector('a[href="#logout"]').addEventListener('click', () => {
            token = null;
            localStorage.removeItem('adminToken');
            updateNav();
            document.getElementById('login').scrollIntoView({ behavior: 'smooth' });
        });

        // Fetch appointments
        async function fetchAppointments() {
            if (!token) return;
            try {
                const response = await fetch('/api/appointments', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch appointments');
                const appointments = await response.json();
                renderAppointments(appointments);
            } catch (error) {
                console.error('Error fetching appointments:', error);
                alert('Failed to fetch appointments');
            }
        }

        // Render appointments
        function renderAppointments(appointments) {
            const tableBody = document.getElementById('appointments-table-body');
            tableBody.innerHTML = '';
            if (appointments.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="9" class="p-3 text-center">No appointments found.</td></tr>';
            } else {
                appointments.forEach(appt => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-3">${appt.full_name}</td>
                        <td class="p-3">${appt.phone}</td>
                        <td class="p-3">${appt.treatment}</td>
                        <td class="p-3">₹${appt.price}</td>
                        <td class="p-3">${appt.date}</td>
                        <td class="p-3">${appt.time}</td>
                        <td class="p-3">${appt.status}</td>
                        <td class="p-3">${appt.payment_id ? 'Paid' : 'Pending'}</td>
                        <td class="p-3">
                            <button class="text-blue-600 hover:underline view-appt" data-id="${appt.id}">View</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // View appointment details
            document.querySelectorAll('.view-appt').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.dataset.id;
                    const appt = appointments.find(a => a.id == id);
                    document.getElementById('detail-name').textContent = appt.full_name;
                    document.getElementById('detail-phone').textContent = appt.phone;
                    document.getElementById('detail-treatment').textContent = appt.treatment;
                    document.getElementById('detail-price').textContent = `₹${appt.price}`;
                    document.getElementById('detail-date').textContent = appt.date;
                    document.getElementById('detail-time').textContent = appt.time;
                    document.getElementById('detail-status').textContent = appt.status;
                    document.getElementById('detail-approved').textContent = appt.approved ? 'Yes' : 'No';
                    document.getElementById('detail-cancel-reason').textContent = appt.cancel_reason || 'N/A';
                    document.getElementById('detail-reschedule-reason').textContent = appt.reschedule_reason || 'N/A';
                    document.getElementById('detail-admin-reason').textContent = appt.admin_reason || 'N/A';
                    document.getElementById('detail-payment-id').textContent = appt.payment_id || 'N/A';
                    document.getElementById('appointment-details').classList.remove('hidden');

                    // Approve appointment
                    document.getElementById('approve-appointment').onclick = async () => {
                        try {
                            const response = await fetch(`/api/appointments/${id}/approve`, {
                                method: 'POST',
                                headers: { 'Authorization': `Bearer ${token}` }
                            });
                            if (!response.ok) throw new Error((await response.json()).message);
                            document.getElementById('appointment-details').classList.add('hidden');
                            fetchAppointments();
                        } catch (error) {
                            alert('Failed to approve appointment: ' + error.message);
                        }
                    };

                    // Cancel appointment
                    document.getElementById('cancel-appointment').onclick = () => {
                        document.getElementById('appointment-details').classList.add('hidden');
                        document.getElementById('cancel-modal').classList.remove('hidden');
                        document.getElementById('confirm-cancel').onclick = async () => {
                            const reason = document.getElementById('cancel-reason').value;
                            if (!reason) {
                                alert('Reason required');
                                return;
                            }
                            try {
                                const response = await fetch(`/api/appointments/${id}/admin-cancel`, {
                                    method: 'POST',
                                    headers: {
                                        'Content-Type': 'application/json',
                                        'Authorization': `Bearer ${token}`
                                    },
                                    body: JSON.stringify({ reason })
                                });
                                if (!response.ok) throw new Error((await response.json()).message);
                                document.getElementById('cancel-modal').classList.add('hidden');
                                document.getElementById('cancel-reason').value = '';
                                fetchAppointments();
                            } catch (error) {
                                alert('Failed to cancel appointment: ' + error.message);
                            }
                        };
                    };
                });
            });
        }

        // Close appointment details
        document.getElementById('close-details').addEventListener('click', () => {
            document.getElementById('appointment-details').classList.add('hidden');
        });

        // Close cancel modal
        document.getElementById('close-cancel').addEventListener('click', () => {
            document.getElementById('cancel-modal').classList.add('hidden');
            document.getElementById('cancel-reason').value = '';
        });

        // Fetch treatments
        async function fetchTreatments() {
            if (!token) return;
            try {
                const response = await fetch('/api/treatments', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch treatments');
                const treatments = await response.json();
                renderTreatments(treatments);
            } catch (error) {
                console.error('Error fetching treatments:', error);
                alert('Failed to fetch treatments');
            }
        }

        // Render treatments
        function renderTreatments(treatments) {
            const tableBody = document.getElementById('treatments-table-body');
            tableBody.innerHTML = '';
            if (treatments.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="5" class="p-3 text-center">No treatments found.</td></tr>';
            } else {
                treatments.forEach(treatment => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-3">${treatment.name}</td>
                        <td class="p-3">₹${treatment.price}</td>
                        <td class="p-3">${treatment.image_url ? `<img src="${treatment.image_url}" alt="${treatment.name}" class="h-16">` : 'N/A'}</td>
                        <td class="p-3">${treatment.video_url ? `<video src="${treatment.video_url}" class="h-16" controls></video>` : 'N/A'}</td>
                        <td class="p-3">
                            <button class="text-blue-600 hover:underline edit-treatment" data-id="${treatment.id}">Edit</button>
                            <button class="text-red-600 hover:underline delete-treatment" data-id="${treatment.id}">Delete</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                });
            }

            // Edit treatment
            document.querySelectorAll('.edit-treatment').forEach(btn => {
                btn.addEventListener('click', () => {
                    const id = btn.dataset.id;
                    const treatment = treatments.find(t => t.id == id);
                    document.getElementById('treatment-id').value = id;
                    document.getElementById('treatment-name').value = treatment.name;
                    document.getElementById('treatment-price').value = treatment.price;
                    document.getElementById('add-treatment').textContent = 'Update Treatment';
                    document.getElementById('treatments').scrollIntoView({ behavior: 'smooth' });
                });
            });

            // Delete treatment
            document.querySelectorAll('.delete-treatment').forEach(btn => {
                btn.addEventListener('click', async () => {
                    const id = btn.dataset.id;
                    if (!confirm('Are you sure you want to delete this treatment?')) return;
                    try {
                        const response = await fetch(`/api/treatments/${id}`, {
                            method: 'DELETE',
                            headers: { 'Authorization': `Bearer ${token}` }
                        });
                        if (!response.ok) throw new Error((await response.json()).message);
                        fetchTreatments();
                    } catch (error) {
                        alert('Failed to delete treatment: ' + error.message);
                    }
                });
            });
        }

        // Add/Edit treatment
        document.getElementById('add-treatment').addEventListener('click', async () => {
            const id = document.getElementById('treatment-id').value;
            const name = document.getElementById('treatment-name').value;
            const price = document.getElementById('treatment-price').value;
            const image = document.getElementById('treatment-image').files[0];
            const video = document.getElementById('treatment-video').files[0];

            if (!name || !price) {
                alert('Name and price required');
                return;
            }

            const formData = new FormData();
            formData.append('name', name);
            formData.append('price', price);
            if (image) formData.append('image', image);
            if (video) formData.append('video', video);

            try {
                const url = id ? `/api/treatments/${id}` : '/api/treatments';
                const method = id ? 'PUT' : 'POST';
                const response = await fetch(url, {
                    method,
                    headers: { 'Authorization': `Bearer ${token}` },
                    body: formData
                });
                if (!response.ok) throw new Error((await response.json()).message);

                document.getElementById('treatment-id').value = '';
                document.getElementById('treatment-name').value = '';
                document.getElementById('treatment-price').value = '';
                document.getElementById('treatment-image').value = '';
                document.getElementById('treatment-video').value = '';
                document.getElementById('add-treatment').textContent = 'Save Treatment';
                fetchTreatments();
            } catch (error) {
                alert('Failed to save treatment: ' + error.message);
            }
        });

        // Fetch timings
        async function fetchTimings() {
            if (!token) return;
            try {
                const response = await fetch('/api/timings', {
                    headers: { 'Authorization': `Bearer ${token}` }
                });
                if (!response.ok) throw new Error('Failed to fetch timings');
                const timings = await response.json();
                renderTimings(timings);
            } catch (error) {
                console.error('Error fetching timings:', error);
                alert('Failed to fetch timings');
            }
        }

        // Render timings
        function renderTimings(timings) {
            const tableBody = document.getElementById('timings-table-body');
            tableBody.innerHTML = '';
            if (timings.length === 0) {
                tableBody.innerHTML = '<tr><td colspan="3" class="p-3 text-center">No timings found.</td></tr>';
            } else {
                timings.forEach(timing => {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td class="p-3">${timing.day}</td>
                        <td class="p-3">${timing.open_time}</td>
                        <td class="p-3">${timing.close_time}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        // Update timing
        document.getElementById('update-timing').addEventListener('click', async () => {
            const day = document.getElementById('timing-day').value;
            const openTime = document.getElementById('open-time').value;
            const closeTime = document.getElementById('close-time').value;

            if (!openTime || !closeTime) {
                alert('Open and close times required');
                return;
            }

            try {
                const response = await fetch(`/api/timings/${day}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ open_time: openTime, close_time: closeTime })
                });
                if (!response.ok) throw new Error((await response.json()).message);

                document.getElementById('open-time').value = '';
                document.getElementById('close-time').value = '';
                fetchTimings();
            } catch (error) {
                alert('Failed to update timing: ' + error.message);
            }
        });

        // Initial fetch if logged in
        if (token) {
            fetchAppointments();
            fetchTreatments();
            fetchTimings();
        }
    </script>
</body>
</html>